<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¬ - Ù†Ø¸Ø§Ù… Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;800&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(135deg, #FDFBF7 0%, #F5EBD9 100%);
            min-height: 100vh;
            padding: 0;
            position: relative;
            overflow-x: hidden;
        }

        /* Background Pattern */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M20 20.5V18H0v-2h20v-2H0v-2h20v-2H0V8h20V6H0V4h20V2H0V0h22v20h2V0h2v20h2V0h2v20h2V0h2v20h2v2h-20v2h20v2h-20v2h20v2h-20v2h20v2h-20v2h20v2h-20v2h20v2h-22V22h-2v20h-2V22h-2v20h-2V22h-2v20h-2V22h-2v20H0V22h20v-1.5z' fill='%23d0a968' fill-opacity='0.07' fill-rule='evenodd'/%3E%3C/svg%3E");
            opacity: 0.6;
            pointer-events: none;
            z-index: 0;
        }

        /* Blur Circles */
        .blur-circle-1 {
            position: fixed;
            top: -100px;
            right: -100px;
            width: 320px;
            height: 320px;
            background: rgba(235, 220, 182, 0.3);
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
        }

        .blur-circle-2 {
            position: fixed;
            top: 160px;
            left: -50px;
            width: 256px;
            height: 256px;
            background: rgba(197, 217, 197, 0.3);
            border-radius: 50%;
            filter: blur(80px);
            z-index: 0;
        }

        .container {
            max-width: 448px;
            margin: 0 auto;
            min-height: 100vh;
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            padding-bottom: 32px;
        }

        /* Header */
        header {
            padding: 48px 24px 24px;
        }

        .logo-container {
            text-align: center;
            margin-bottom: 24px;
        }

        .logo-container img {
            height: 80px;
            object-fit: contain;
        }

        /* Glass Card */
        .glass-card {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(203, 107, 4, 0.15);
            position: relative;
            overflow: hidden;
        }

        .glass-card::before {
            content: '';
            position: absolute;
            right: -24px;
            top: -24px;
            width: 96px;
            height: 96px;
            background: linear-gradient(135deg, #ebdcb6 0%, #fbf7ef 100%);
            border-radius: 50%;
            opacity: 0.5;
            filter: blur(40px);
        }

        .glass-card-content {
            position: relative;
            z-index: 1;
        }

        .title-card {
            text-align: center;
        }

        .title-card .icon {
            font-size: 64px;
            margin-bottom: 12px;
        }

        .title-card h1 {
            font-family: 'Amiri', serif;
            font-size: 28px;
            font-weight: 700;
            color: #64462E;
            margin-bottom: 4px;
        }

        .title-card p {
            font-size: 14px;
            color: #B88B4D;
            opacity: 0.9;
        }

        /* Main Content */
        main {
            flex: 1;
            padding: 0 24px;
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 0;
        }

        .spinner {
            width: 64px;
            height: 64px;
            border: 4px solid #F5EBD9;
            border-top: 4px solid #CB6B04;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading p {
            color: #B88B4D;
            font-weight: 600;
        }

        /* Pilgrim Name Card */
        .name-card {
            margin-bottom: 16px;
        }

        .pilgrim-name {
            font-family: 'Amiri', serif;
            font-size: 36px;
            font-weight: 700;
            color: #64462E;
            text-align: center;
            margin-bottom: 8px;
        }

        .pilgrim-name-en {
            font-size: 20px;
            color: #B88B4D;
            text-align: center;
            margin-bottom: 16px;
        }

        /* Status Badge */
        .status-container {
            display: flex;
            justify-content: center;
            margin-top: 16px;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 700;
        }

        .status-healthy {
            background: #C5D9C5;
            color: #568256;
        }

        .status-sick {
            background: #FFE4CC;
            color: #F97316;
        }

        .status-emergency {
            background: #FFE4E6;
            color: #EF4444;
        }

        /* Info Card */
        .info-card {
            margin-bottom: 16px;
        }

        .info-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            margin-bottom: 16px;
            border-bottom: 2px solid #F5EBD9;
        }

        .info-header .icon {
            font-size: 28px;
            color: #CB6B04;
        }

        .info-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: #64462E;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-top: 1px solid #FDFBF7;
        }

        .info-row:first-child {
            border-top: none;
        }

        .info-label {
            color: #9CA3AF;
            font-size: 14px;
        }

        .info-value {
            color: #64462E;
            font-size: 14px;
            font-weight: 700;
        }

        /* Action Buttons */
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 24px;
        }

        .action-buttons.single {
            grid-template-columns: 1fr;
        }

        .btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 20px;
            border: none;
            border-radius: 24px;
            font-family: 'Cairo', sans-serif;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-emergency {
            background: #EF4444;
            color: white;
        }

        .btn-emergency:hover {
            background: #DC2626;
            box-shadow: 0 6px 16px rgba(239, 68, 68, 0.4);
        }

        .btn-call {
            background: #568256;
            color: white;
        }

        .btn-call:hover {
            background: #4A6F4A;
            box-shadow: 0 6px 16px rgba(86, 130, 86, 0.4);
        }

        .btn .icon {
            font-size: 32px;
        }

        /* Footer */
        footer {
            padding: 24px;
            text-align: center;
        }

        .footer-card {
            padding: 16px;
        }

        .footer-card .icon {
            font-size: 32px;
            margin-bottom: 8px;
        }

        .footer-card p {
            color: #946A3D;
            font-size: 14px;
            font-weight: 600;
        }

        .footer-card .copyright {
            color: #B88B4D;
            font-size: 12px;
            margin-top: 4px;
        }

        /* Error */
        .error {
            text-align: center;
            padding: 48px 24px;
        }

        .error .icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .error h3 {
            font-size: 20px;
            font-weight: 700;
            color: #EF4444;
            margin-bottom: 8px;
        }

        .error p {
            color: #9CA3AF;
        }
    </style>
</head>
<body>
    <div class="blur-circle-1"></div>
    <div class="blur-circle-2"></div>

    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo-container">
                <img src="logo.png" alt="Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±">
            </div>

            <div class="glass-card title-card">
                <div class="glass-card-content">
                    <div class="icon">ğŸ•‹</div>
                    <h1>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ø¬</h1>
                    <p>Ù†Ø¸Ø§Ù… Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ø­Ø¬</p>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="content">
            <div class="loading">
                <div class="spinner"></div>
                <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
            </div>
        </main>

        <!-- Footer -->
        <footer>
            <div class="glass-card footer-card">
                <div class="glass-card-content">
                    <div class="icon">ğŸ“±</div>
                    <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© ÙˆÙ…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø­Ø¬Ø§Ø¬</p>
                    <p class="copyright">Â© 2024 Ù…Ù†Ø§Ø³Ùƒ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const pilgrimId = urlParams.get('id');

        if (!pilgrimId) {
            showError('Ù…Ø¹Ø±Ù Ø§Ù„Ø­Ø§Ø¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·');
        } else {
            loadPilgrimData(pilgrimId);
        }

        async function loadPilgrimData(id) {
            try {
                const SUPABASE_URL = 'https://cyyanlvreiwmebluguhh.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImN5eWFubHZyZWl3bWVibHVndWhoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcwNjcxMDksImV4cCI6MjA4MjY0MzEwOX0.7IMEUXu4jIC7DJUAIEWPHYakR6Djmpu5TD8pFA3j0vk';
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/pilgrims?id=eq.${id}&select=*,camps:camp_id(*)`, {
                    headers: {
                        'apikey': SUPABASE_ANON_KEY,
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`
                    }
                });
                
                if (!response.ok) throw new Error('ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');

                const data = await response.json();
                
                if (!data || data.length === 0) {
                    throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ø¬');
                }

                displayPilgrimData(data[0]);
            } catch (error) {
                showError(error.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            }
        }

        function displayPilgrimData(data) {
            const healthStatusMap = {
                'healthy': { text: 'Ø³Ù„ÙŠÙ…', class: 'status-healthy', icon: 'âœ…' },
                'sick': { text: 'Ù…Ø±ÙŠØ¶', class: 'status-sick', icon: 'âš ï¸' },
                'emergency': { text: 'Ø­Ø§Ù„Ø© Ø·ÙˆØ§Ø±Ø¦', class: 'status-emergency', icon: 'ğŸš¨' }
            };

            const status = healthStatusMap[data.health_status] || healthStatusMap['healthy'];
            const nationalId = data.national_id ? data.national_id.substring(0, 4) + '****' : 'ØºÙŠØ± Ù…ØªÙˆÙØ±';

            let html = `
                <!-- Pilgrim Name -->
                <div class="glass-card name-card">
                    <div class="glass-card-content">
                        <div class="pilgrim-name">${data.full_name_arabic || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</div>
                        ${data.full_name_english ? `<div class="pilgrim-name-en">${data.full_name_english}</div>` : ''}
                        
                        <div class="status-container">
                            <div class="status-badge ${status.class}">
                                <span>${status.icon}</span>
                                <span>${status.text}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Basic Info -->
                <div class="glass-card info-card">
                    <div class="glass-card-content">
                        <div class="info-header">
                            <div class="icon">ğŸ‘¤</div>
                            <h3>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h3>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ</span>
                            <span class="info-value">${nationalId}</span>
                        </div>
                        ${data.blood_type ? `
                        <div class="info-row">
                            <span class="info-label">ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</span>
                            <span class="info-value">${data.blood_type}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
            `;

            // Trip Info
            if (data.group_number || data.bus_number || data.camps?.name) {
                html += `
                <div class="glass-card info-card">
                    <div class="glass-card-content">
                        <div class="info-header">
                            <div class="icon">â›º</div>
                            <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø©</h3>
                        </div>
                        ${data.group_number ? `
                        <div class="info-row">
                            <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</span>
                            <span class="info-value">${data.group_number}</span>
                        </div>
                        ` : ''}
                        ${data.bus_number ? `
                        <div class="info-row">
                            <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ø¨Ø§Øµ</span>
                            <span class="info-value">${data.bus_number}</span>
                        </div>
                        ` : ''}
                        ${data.camps?.name ? `
                        <div class="info-row">
                            <span class="info-label">Ø§Ù„Ù…Ø®ÙŠÙ…</span>
                            <span class="info-value">${data.camps.name}</span>
                        </div>
                        ` : ''}
                        ${data.camps?.location_name ? `
                        <div class="info-row">
                            <span class="info-label">Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø®ÙŠÙ…</span>
                            <span class="info-value">ğŸ“ ${data.camps.location_name}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
                `;
            }

            // Emergency Contact
            if (data.emergency_contact_name || data.emergency_contact_phone) {
                html += `
                <div class="glass-card info-card">
                    <div class="glass-card-content">
                        <div class="info-header">
                            <div class="icon">ğŸ“</div>
                            <h3>Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦</h3>
                        </div>
                        ${data.emergency_contact_name ? `
                        <div class="info-row">
                            <span class="info-label">Ø§Ù„Ø§Ø³Ù…</span>
                            <span class="info-value">${data.emergency_contact_name}</span>
                        </div>
                        ` : ''}
                        ${data.emergency_contact_phone ? `
                        <div class="info-row">
                            <span class="info-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</span>
                            <span class="info-value">${data.emergency_contact_phone}</span>
                        </div>
                        ` : ''}
                    </div>
                </div>
                `;
            }

            // Action Buttons
            const hasEmergency = data.emergency_contact_phone;
            const hasPhone = data.phone;
            
            if (hasEmergency || hasPhone) {
                html += `<div class="action-buttons ${!hasEmergency || !hasPhone ? 'single' : ''}">`;
                
                if (hasEmergency) {
                    html += `
                    <a href="tel:${data.emergency_contact_phone}" class="btn btn-emergency">
                        <div class="icon">ğŸ“</div>
                        <span>Ø§ØªØµØ§Ù„ Ø·ÙˆØ§Ø±Ø¦</span>
                    </a>
                    `;
                }
                
                if (hasPhone) {
                    html += `
                    <a href="tel:${data.phone}" class="btn btn-call">
                        <div class="icon">ğŸ“±</div>
                        <span>Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø­Ø§Ø¬</span>
                    </a>
                    `;
                }
                
                html += `</div>`;
            }

            document.getElementById('content').innerHTML = html;
        }

        function showError(message) {
            document.getElementById('content').innerHTML = `
                <div class="glass-card">
                    <div class="glass-card-content error">
                        <div class="icon">âš ï¸</div>
                        <h3>Ø­Ø¯Ø« Ø®Ø·Ø£</h3>
                        <p>${message}</p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>
